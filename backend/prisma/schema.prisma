generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  username  String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  eventTypes EventType[]
  bookings      Booking[]
  schedules     Schedule[]
}

model EventType {
  id          String     @id @default(cuid())
  userId      String
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title       String
  description String?
  slug        String     @unique
  duration    Int        // in minutes
  color       String     @default("#000000")
  image       String?
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  scheduleId       String?
  schedule         Schedule? @relation(fields: [scheduleId], references: [id])
  availability     Availability[]
  dateOverrides    DateOverride[]
  bookings         Booking[]

  @@unique([userId, slug])
}

model Schedule {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name      String
  isDefault Boolean  @default(false)
  
  availability Availability[]
  eventTypes   EventType[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([userId, name])
}

model Availability {
  id              String     @id @default(cuid())
  
  eventTypeId     String?
  eventType       EventType?  @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  
  scheduleId      String?
  schedule        Schedule?   @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  
  dayOfWeek       Int        // 0-6 (Sunday-Saturday)
  startTime       String     // HH:MM
  endTime         String     // HH:MM
  timezone        String     @default("UTC")
  bufferMinutes   Int        @default(0)
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@index([eventTypeId])
  @@index([scheduleId])
}

model DateOverride {
  id              String     @id @default(cuid())
  eventTypeId     String
  eventType       EventType  @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  
  date            DateTime
  startTime       String?
  endTime         String?
  isBlocked       Boolean    @default(true)
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@unique([eventTypeId, date])
}

model Booking {
  id              String     @id @default(cuid())
  eventTypeId     String
  eventType       EventType  @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)
  userId          String
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  guestName       String
  guestEmail      String
  guestPhone      String?
  
  startTime       DateTime
  endTime         DateTime
  
  notes           String?
  status          String     @default("confirmed")
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  @@index([eventTypeId])
  @@index([userId])
}
